permute = function(val_vec, idx_vec, mode)
  local val_qtype = assert(val_vec:fldtype())
  local val_ttype = q_to_terra[val_qtype]  
  local idx_qtype = assert(idx_vec:fldtype())
  local idx_ttype = q_to_terra[idx_qtype]  
  local val_n, val_vec = val_vec:get_all()
  local     _, idx_vec = idx_vec:get_all()
  local val_width = qconsts.qtypes[val_qtype].width
  local out = ffi.malloc(val_width * val_n)
  t_permute(val_ttype, idx_ttype)(val_vec, idx_vec, out, val_n, mode)
  -- create blank vector whose meta is cloned from val_vec's meta
  local out_vec = Vector({qtype = val_qtype})
  out_vec:put_chunk(out, nil, val_n) 
  out_vec:eov()
  return out_vec
end
